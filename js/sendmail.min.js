jQuery(document).ready(function(b){b.overlay.init();var a=b("#fcontact .contact-form");b("#fcontact .contact-form input[type=submit]").click(function(){if(!e(a.get()[0])){return true;
}ref=b(this);FB.getLoginStatus(function(h){if(h.status==="connected"){var i=b("#fcontact input.name").val();var g=b("#fcontact input.mail").val();var j=c(fcontact_sendmail.send_info,{name:i,mail:g});
b.overlay.show({dialog:true,title:fcontact_sendmail.send_title,text:'<p style="text-indent:1em;">'+j+"</p>",onlyOK:false,autoHide:false,okFunc:function(){f(a);
}});}else{FB.login(function(k){if(k.authResponse){FB.api("/me?fields=id,name,email&locale=ja_JP",function(l){console.log(l);setForm(l);var m=c(fcontact_sendmail.send_info,{name:l.name,mail:l.email});
b.overlay.show({dialog:true,title:fcontact_sendmail.send_title,text:'<p style="text-indent:1em;">'+m+"</p>",onlyOK:false,autoHide:false,okFunc:function(){f(a);
}});});}},{scope:"email"});}});if(!fb_activate){b.overlay.show({dialog:true,text:"<em>"+fcontact_sendmail.fbapp_not_enable+"</em>",onlyOK:true});}return false;
});b("#fcontact .confirm-area input[type=reset]").click(function(){a.find("textarea").prop("readonly",false);a.find("input.confirm,input.clear,input.logout").prop("disabled",false);
b("html,body").animate({scrollTop:a.offset().top},"fast");b("#fcontact .confirm-area").hide();return false;});b("#fcontact .contact-form .logout").click(function(){fbLogout();
b.overlay.show({dialog:true,title:null,text:'<p">'+fcontact_sendmail.logout_msg+"</p>",});return false;});b("#fcontact .result-area .back").click(function(){window.location.reload();
return false;});b("#fcontact-overlay .close").click(function(){hideOverlay("dialog",false);return true;});function e(g){return g.checkValidity();}function d(g){if(g){b("#fcontact .result-area").addClass("success");
}else{b("#fcontact .result-area").addClass("error");}a.hide();b("#fcontact .result-area").show();}function f(g){formdata=g.serialize();b.overlay.update({dialog:false,text:'<i class="fa fa-paper-plane"></i>&emsp;'+fcontact_sendmail.sending_msg});
b.ajax({type:"POST",url:ajaxurl,data:formdata,dataType:"json"}).done(function(h){if(h.result==="success"){console.log(h);d(true);b.overlay.hide();}else{console.log("sendmail error: cause:"+h.cause);
d(false);b.overlay.hide();}}).fail(function(){b("#fcontact .result-area .error .cause").text("Server Error.");d(false);b.overlay.hide();});}function c(g,h){return g.replace(/%{(.*?)}/g,function(j,i){return(h[i]&&typeof(h[i])!="object")?h[i].toString():JSON.stringify(h[i]);
});}});function setForm(a){jQuery("#fcontact").removeClass("logout");jQuery("#fcontact input.fbid").val(a.id);jQuery("#fcontact input.name").val(a.name);
jQuery("#fcontact input.mail").val(a.email);}function clearForm(){jQuery("#fcontact input.fbid").val("");jQuery("#fcontact input.name").val("");jQuery("#fcontact input.mail").val("");
}function fbLogout(){FB.logout(function(a){jQuery("#fcontact").addClass("logout");clearForm();});}function statusChangeCallback(a){if(a.status==="connected"){FB.api("/me?fields=id,name,email&locale=ja_JP",function(b){console.log(b);
setForm(b);});}else{console.log("user is not logged in.");clearForm();}}